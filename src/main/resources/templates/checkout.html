<!DOCTYPE html>
<html lang="en">
  <head th:replace="layout :: head(~{::title})">
    <title>Home</title>
  </head>
  <body>
    <!--================ Start Header Menu Area =================-->
    <header th:replace="layout :: header"></header>
    <!--================ End Header Menu Area =================-->

    <!-- ================ start banner area ================= -->
    <section class="blog-banner-area" id="category">
      <div class="container h-100">
        <div class="blog-banner">
          <div class="text-center">
            <h1>Product Checkout</h1>
            <nav aria-label="breadcrumb" class="banner-breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                  Checkout
                </li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </section>
    <!-- ================ end banner area ================= -->

    <!--================Checkout Area =================-->
    <section class="checkout_area section-margin--small">
      <div class="container">
        <div class="billing_details">
          <div class="row">
            <div class="col-lg-8">
              <h3>Billing Details</h3>
                <div class="col-md-6 form-group p_star">
                  <textarea
                    class="form-control"
                    name="message"
                    id="message"
                    rows="1"
                    placeholder="Order Notes"
                  ></textarea>
                </div>
            </div>
            <div class="col-lg-4">
              <div class="order_box">
                <h2>Your Order</h2>
                <ul class="list" id="body"></ul>
                <div class="order-btn">
                  <!-- <a class="button button-paypal" href="#"
                    >Payment</a
                  > -->
                  <button type="submit" id="payment" class="site-btn place-btn">
                    Payment
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--================End Checkout Area =================-->

    <!--================ Start footer Area  =================-->
    <footer th:replace="layout :: footer"></footer>
    <!--================ End footer Area  =================-->
  </body>
  <script>
    let carts = JSON.parse(sessionStorage.getItem("cart"))
    let cartNoJSON = sessionStorage.getItem("cart")
    let total = 0
    $("#body").append(`<li>Product <span>Total</span></li>`)
    if (carts !== null) {
      carts.map((cart) => {
        total += cart.price * cart.quantity
        id = cart.id
        $("#body").append(
          `<li class="fw-normal">
                    ${cart.productName} <b>x</b> ${cart.quantity}
                    <span>$${cart.price * cart.quantity}.00</span>
                </li>`
        )
      })
    }
    $("#body").append(
      `<li class="total-price" >Total<span id="totalPrice">$${total.toFixed(
        2
      )}</span></li>`
    )

    $("#payment").click(function () {
      fetch("/checkout/add", {
        method: "POST",
        mode: "cors",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({carts, total, note: document.querySelector('.form-control').value})
      }).catch((err) => { console.log(err)})
      sessionStorage.removeItem("cart")
      alert("Thanh toán thành công")
      location.href = "/"
    })
  </script>
</html>
